{% extends "base.html" %} {% block content %} {% load static %}

<head>
    <script src='https://code.jquery.com/jquery-3.3.1.min.js'></script>
</head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<h2>Parse the uploaded text</h2>

<style>
    .hl {
        background: #ffffff;
    }
    
    .hl:hover {
        background: #95db79;
    }
</style>

{% if user.is_authenticated %}
<p> {{user}} logged in</p>
<br><br>
<form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    <button type="submit">Parse!</button>
</form>
<br>
<center>

    <br> {% if sentences %}

    <script>
        let word = "";
        const sentence_array = []
    </script>
    <h3>Sentences with potential trait data:</h3>
    <h4>Select a traitname </h4>
    <br>
    <script>
        var json_sents = '{{json_sentences | safe}}'
        console.log(json_sents.constructor.name) <
            /script>  <
            script >
            // Function to get the Selected Text 
            function getSelectedText() {
                var selectedText = '';

                // window.getSelection
                if (window.getSelection) {
                    selectedText = window.getSelection();
                }
                // document.getSelection
                else if (document.getSelection) {
                    selectedText = document.getSelection();
                }
                // document.selection
                else if (document.selection) {
                    selectedText =
                        document.selection.createRange().text;
                } else return;
                // To write the selected text into the textarea

                document.testform.selectedtext.value = selectedText;
            }
    </script>
    <!-- <script>
        // Here the value is stored in new variable x 
        var i = 0;

        function getTraitValue() {

            var x =
                document.getElementById("trait_value").value;

            document.getElementById("trait").innerHTML = x;
            console.log(x)
            i++;
            traitvalues[sentences[index - 1]] = x;
            console.table(traitvalues)


        }
    </script> -->
    <H4 id="trait"></H4>
    {% for sent in sentences %}
    <script type="text/javascript">
        sentence = "{{ sent}}";
        sentence_array.push(sentence)
    </script>
    <p></p>
    {% endfor %}
    <script>
        const sentences = sentence_array
        let index = 0

        function loop() {
            document.getElementById("element").innerHTML = sentences[index]
            index++
        }
    </script>
    <script>
        function getCookie(name) {
            let cookie = document.cookie.match('(^|;) ?' + name + '=([^;]*)(;|$)');
            return cookie ? cookie[2] : null;
        }

        function fetchTraitValues() {
            URL = "{% url 'ajax_url' %}"
            var data = {
                sentence: sentence_array[index - 1],
                trait_value: document.getElementById("trait_value").value
            };

            fetch(URL, {
                    method: 'post',
                    headers: {
                        "X-CSRFToken": getCookie("csrftoken"),
                        'Accept': 'application/json',
                    },
                    body: JSON.stringify(data),
                })
                .then((res) => {
                    return res.json()
                })
                .then(json => {

                })
                .catch(err => {
                    alert(`Error: ${err}`, 'danger');
                    console.log(err)
                });

        }
    </script>
    <div id="element"></div>
    <button onclick="loop()">Show Next Sentence</button>
    <input type="button" value="Get Selection" onmousedown="getSelectedText();">

    <form name="testform">
        <textarea name="selectedtext" id="trait_value" rows="2" cols="10"></textarea>
    </form>
    <!-- <input class="post" onmousedown=" fetchTraitValues() " value="Confirm Selection "> -->
    <button class="post" onClick="fetchTraitValues()">Confirm Selection</button>
</center>


{% endif %} {% csrf_token %}
<br><br>
<br>
<a href="{% url 'pdf_list' %} " class="w3-btn w3-black ">Back to pdf list</a>
<br> {% else %}
<p>Please login first</p>
{% endif %} {% endblock content %}


</script> -->